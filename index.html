<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Panel Admin - LimpiArte</title>

  <!-- Bootstrap + SweetAlert -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

  <!-- Tu CSS -->
  <link rel="stylesheet" href="adminstyle.css">
</head>
<body>

<header class="app-header">
  <div class="header-content">
    <div class="header-left">
      <button id="btn-hamburger" class="hamburger-btn mobile-menu-btn">‚ò∞</button>
      <div class="brand">LimpiArte</div>
    </div>
  </div>
</header>

<div class="top-bar-ui container">
  <div class="search-wrap">
    <input id="search-input" class="form-control" placeholder="Buscar productos..." type="search">
    <button id="search-clear" class="search-clear" type="button">‚úï</button>
    <div id="search-suggestions" class="suggestions-box"></div>
  </div>

  <select id="global-order" class="form-select mt-2">
    <option value="creado_desc">M√°s recientes</option>
    <option value="creado_asc">M√°s antiguos</option>
    <option value="precio_asc">Precio ‚Üë</option>
    <option value="precio_desc">Precio ‚Üì</option>
    <option value="stock_asc">Stock ‚Üë</option>
    <option value="stock_desc">Stock ‚Üì</option>
  </select>
</div>

<nav id="app-drawer" class="app-drawer" aria-hidden="true">
  <div class="drawer-header d-flex align-items-center justify-content-between px-3">
    <strong>Men√∫</strong>
    <button id="drawer-close" class="btn btn-sm">‚úï</button>
  </div>
  <ul class="list-unstyled m-0 p-3">
    <li><a href="#" data-section="products" class="drawer-link">Productos</a></li>
    <li><a href="#" data-section="add" class="drawer-link">A√±adir Producto</a></li>
    <li><a href="#" data-section="categories" class="drawer-link">Categor√≠as</a></li>
    <li><a href="#" data-section="images" class="drawer-link">Im√°genes</a></li>
    <li><a href="#" data-section="settings" class="drawer-link">Ajustes</a></li>
  </ul>
</nav>

<div id="drawer-overlay" class="drawer-overlay"></div>

<div id="loader" class="loader-container d-none">
  <div class="spinner-border text-primary"></div>
</div>

<main class="app-main container py-4" style="display:none;">

  <div class="d-flex gap-2 mb-3 align-items-center">
    <div class="dropdown">
      <button class="btn btn-success btn-sm dropdown-toggle" data-bs-toggle="dropdown">
        üì§ Exportar
      </button>
      <ul class="dropdown-menu shadow-lg">
        <li><a class="dropdown-item" href="#" data-exp="xlsx">üìó Excel (.xlsx)</a></li>
        <li><a class="dropdown-item" href="#" data-exp="csv">üìÑ CSV (.csv)</a></li>
        <li><a class="dropdown-item" href="#" data-exp="doc">üìù Word (.doc)</a></li>
        <li><a class="dropdown-item" href="#" data-exp="pdf">üìò PDF moderno</a></li>
      </ul>
    </div>

    <button id="import-excel" class="btn btn-primary btn-sm">üì• Importar Excel</button>
    <input type="file" id="import-excel-input" accept=".xlsx" hidden>

    <input id="pdf-logo-url" class="form-control form-control-sm"
           placeholder="URL del logo para PDF (opcional)"
           style="max-width:220px;">
  </div>

  <div class="row">

    <section id="section-add" class="col-md-5 mb-4 d-none">
      <div class="card p-3 shadow">
        <h4 id="form-title">A√±adir Producto</h4>

        <form id="admin-form">
          <input type="hidden" id="producto-id">

          <div class="mb-2">
            <label class="form-label">C√≥digo</label>
            <input type="text" id="admin-codigo" class="form-control form-control-sm" required>
          </div>

          <div class="mb-2">
            <label class="form-label">Categor√≠a</label>
            <select id="admin-categoria" class="form-select form-select-sm" required>
              <option value="">Seleccione una categor√≠a</option>
            </select>
          </div>

          <div class="mb-2">
            <label class="form-label">Nombre</label>
            <input type="text" id="admin-nombre" class="form-control form-control-sm" required>
          </div>

          <div class="mb-2">
            <label class="form-label d-flex justify-content-between">
              <span>Descripci√≥n</span>
              <button id="btn-ia-descripcion" type="button" class="btn btn-sm btn-outline-secondary">
                ü§ñ Generar IA
              </button>
            </label>
            <textarea id="admin-descripcion" rows="3" class="form-control form-control-sm"></textarea>
            <div class="mt-1 small text-muted">Eleg√≠ estilo en Ajustes ‚Üí IA si quer√©s otro tono.</div>
          </div>

          <div class="mb-2">
            <label class="form-label">Precio ($)</label>
            <input type="number" id="admin-precio" class="form-control form-control-sm" step="0.01" required>
          </div>

          <div class="mb-2">
            <label class="form-label">Cantidad en Stock</label>
            <input type="number" id="admin-cantidad" class="form-control form-control-sm" min="0" required>
          </div>

          <div class="mb-2 form-check">
            <input type="checkbox" id="admin-en-espera" class="form-check-input">
            <label class="form-check-label">Sin stock</label>
          </div>

          <div class="mb-2">
            <label class="form-label d-block">Imagen del producto</label>
            <button type="button" id="btn-upload-cloudinary" class="btn btn-outline-primary btn-sm">
              Subir imagen
            </button>
            <input type="file" id="cloudinary-file-input" accept="image/*" hidden>

            <img id="selected-image-preview" class="img-thumbnail mt-2 d-none"
                 style="width:120px;height:120px;object-fit:cover;">

            <div id="image-album" class="mt-2"></div>
          </div>

          <div class="d-grid gap-2 mt-3">
            <button class="btn btn-success" type="submit">Guardar</button>
            <button id="cancelar-edicion" type="button" class="btn btn-secondary d-none">Cancelar edici√≥n</button>
          </div>
        </form>
      </div>
    </section>

    <section id="section-products" class="col-md-7 mb-4">
      <div class="card p-3 shadow">
        <h4>Productos</h4>
        <div id="admin-productos" class="list-group mt-2"></div>
      </div>
    </section>

    <section id="section-categories" class="col-md-12 mb-4 d-none">
      <div class="card p-3 shadow">
        <h4>Categor√≠as</h4>
        <div class="d-flex gap-2 mb-3">
          <input id="categoria-nueva" class="form-control" placeholder="Nueva categor√≠a">
          <button id="categoria-agregar" class="btn btn-primary">Agregar</button>
        </div>
        <ul id="lista-categorias" class="list-group"></ul>
      </div>
    </section>

    <section id="section-images" class="d-none">
      <div class="card p-3 shadow">
        <h4>Im√°genes</h4>
        <div id="image-album-manager" class="mt-3"></div>
      </div>
    </section>

    <section id="section-settings" class="d-none">
      <div class="card p-3 shadow">
        <h4>Ajustes</h4>
        <p class="small text-muted">Configura Cloudinary, Firebase y OpenAI (API Key por cliente).</p>

        <!-- Panel IA: guardar API Key (se sincroniza con Firestore) -->
        <div class="card p-2 mt-2">
          <label class="form-label">API Key OpenAI (se guarda por usuario en Firestore)</label>
          <input id="openai-key" type="password" class="form-control mb-2" placeholder="sk-XXXX...">
          <div class="d-flex gap-2">
            <button id="guardar-openai" class="btn btn-primary btn-sm">Guardar API Key</button>
            <select id="openai-style" class="form-select form-select-sm">
              <option value="corta">Corta - 1-2 frases</option>
              <option value="larga">Larga - Descriptiva / Vendedora</option>
              <option value="tecnica">T√©cnica</option>
              <option value="profesional" selected>Cat√°logo profesional</option>
            </select>
          </div>
          <div class="mt-2 small text-muted">La API Key se usa solo por la Firebase Function para llamar a OpenAI.</div>
        </div>

      </div>
    </section>

  </div>
</main>

<!-- Librer√≠as -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.1/jspdf.plugin.autotable.min.js"></script>

<!-- App -->
<script type="module" src="./js/app.js"></script>
</body>
</html>
